<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Reportes - OneDi</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" th:href="@{/css/reporte.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
</head>
<body>
<button class="mobile-menu-toggle" onclick="toggleSidebar()">☰</button>

<div th:replace="fragments/sidebar :: sidebar"></div>

<div class="main-content">
    <div class="page-header">
        <h1>Lista de Reportes</h1>
    </div>

    <div class="report-grid-container">
        <div class="report-card" th:each="reporte : ${reportes}">
            <div class="report-header">
                <div class="report-icon">
                    <i class="fas fa-file-chart-line"></i>
                </div>
                <span class="report-badge" th:text="${'Generado por: '+reporte.generadoPor.getUsuario()}">Generado por</span>
            </div>

            <div class="report-info">
                <h3 class="report-title">Reporte de periodo</h3>
                <div class="report-meta">
                    <div class="meta-item">
                        <i class="far fa-calendar-check"></i>
                        <span class="meta-label">Generado:</span>
                        <span th:text="${#dates.format(reporte.fechaGeneracion, 'dd/MM/yyyy')}">01/01/2024</span>
                    </div>
                    <div class="meta-item">
                        <i class="far fa-calendar-alt"></i>
                        <span class="meta-label">Inicio:</span>
                        <span th:text="${#dates.format(reporte.fechaInicio, 'dd/MM/yyyy')}">01/01/2024</span>
                    </div>
                    <div class="meta-item">
                        <i class="far fa-calendar-times"></i>
                        <span class="meta-label">Final:</span>
                        <span th:text="${#dates.format(reporte.fechaFin, 'dd/MM/yyyy')}">31/01/2024</span>
                    </div>
                </div>
            </div>

            <div class="report-actions">
                <button class="btn-action btn-primary" th:onclick="'verReporte(' + ${reporte.idReporte} + ')'">
                    <i class="fas fa-eye"></i>
                    <span>Ver Detalles</span>
                </button>
                <button class="btn-action btn-danger" th:onclick="'eliminarReporte(' + ${reporte.idReporte} + ')'">
                    <i class="fas fa-trash-alt"></i>
                    <span>Eliminar</span>
                </button>
            </div>
        </div>
    </div>

    <div id="reporteModal" class="modal" >
        <div class="modal-content">
            <span class="close" onclick="cerrarModalReporte()">&times;</span>
            <h2>Reporte</h2>

            <div class="report-container">
                <!-- Tabs y Botones de Exportación -->
                <div class="tabs-section">
                    <div style="display: flex; justify-content: end;">
                        <div class="export-buttons" style="display: flex; justify-content: flex-end; gap: 10px;">
                            <!-- Simplified buttons to call export functions directly, removing modal logic -->
                            <button id="btn-exportar-pdf" class="btn-export btn-export-pdf" onclick="exportarPDF()">
                                <i class="fas fa-file-pdf"></i> Exportar PDF
                            </button>
                            <button id="btn-exportar-excel" class="btn-export btn-export-excel" onclick="exportarExcel()">
                                <i class="fas fa-file-excel"></i> Exportar Excel
                            </button>
                        </div>
                    </div>
                    <div class="tabs-header">
                        <button class="tab-button active" onclick="cambiarTab('all', event)" data-tab="all">Resumen</button>
                        <button class="tab-button" onclick="cambiarTab('partida-doble', event)" data-tab="partida-doble">Partida doble</button>
                        <button class="tab-button" onclick="cambiarTab('libro-mayor', event)" data-tab="libro-mayor">Libro mayor</button>
                        <button class="tab-button" onclick="cambiarTab('balance-comprobacion', event)" data-tab="balance-comprobacion">Balance de comprobación</button>
                        <button class="tab-button" onclick="cambiarTab('estado-resultados', event)" data-tab="estado-resultados">Estado de Resultados</button>
                        <button class="tab-button" onclick="cambiarTab('estado-capital', event)" data-tab="estado-capital">Estado de Capital</button>
                        <button class="tab-button" onclick="cambiarTab('balance-general', event)" data-tab="balance-general">Balance general</button>
                    </div>

                    <div class="tabs-content">
                        <div class="loading" id="loading">
                            <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                            <p>Generando reporte...</p>
                        </div>

                        <!-- Tab: All -->
                        <div class="tab-pane active" id="tab-all">
                            <div class="empty-state">Selecciona un rango de fechas y haz clic en Filtrar para generar el reporte</div>
                        </div>

                        <!-- Tab: Partida Doble (Libro Diario) -->
                        <div class="tab-pane" id="tab-partida-doble">
                            <h3 style="margin-top: 0;">Libro Diario</h3>
                            <div class="table-responsive">
                                <table class="report-table" id="tabla-partida-doble">
                                    <thead>
                                    <tr>
                                        <th># Asiento</th>
                                        <th>Fecha</th>
                                        <th>Descripción</th>
                                        <th></th>
                                        <th>Debe</th>
                                        <th>Haber</th>
                                    </tr>
                                    </thead>
                                    <tbody id="tbody-partida-doble">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Tab: Libro Mayor (Cuentas T) -->
                        <div class="tab-pane" id="tab-libro-mayor">
                            <h3 style="margin-top: 0; margin-bottom: 2rem">Libro Mayor - Cuentas T</h3>
                            <div id="cuentas-t-container">
                            </div>
                        </div>

                        <!-- Tab: Balance de Comprobación -->
                        <div class="tab-pane" id="tab-balance-comprobacion">
                            <h3 style="margin-top: 0;">Balance de Comprobación</h3>
                            <div class="table-responsive">
                                <table class="report-table" id="tabla-balance-comprobacion">
                                    <thead>
                                    <tr>
                                        <th>Cuenta</th>
                                        <th>Tipo</th>
                                        <th class="text-right">Debe</th>
                                        <th class="text-right">Haber</th>
                                    </tr>
                                    </thead>
                                    <tbody id="tbody-balance-comprobacion">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Tab: Estado de Resultados -->
                        <div class="tab-pane" id="tab-estado-resultados">

                            <div id="estado-resultados-container"></div>
                        </div>

                        <!-- Tab: Estado de Capital -->
                        <div class="tab-pane" id="tab-estado-capital">

                            <div id="estado-capital-container"></div>
                        </div>

                        <!-- Tab: Balance General -->
                        <div class="tab-pane" id="tab-balance-general">
                            <h3 style="margin-top: 0; padding-bottom: 2rem;">Balance General</h3>
                            <div id="balance-general-container">
                            </div>
                        </div>
                    </div>
            </div>
            </div>
        </div>
    </div>

</div>
<!-- Replaced html2pdf with jsPDF and autoTable for better performance -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
<!-- Ensure XLSX is loaded and add the new reporte-excel.js script -->
<script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script th:src="@{/js/visualizar-reporte.js}"></script>
<script th:src="@{/js/reporte-excel.js}"></script>
<script th:src="@{/js/Sidebar.js}"></script>
</body>
</html>
